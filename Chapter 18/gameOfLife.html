<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Conway's Game of Life</title>
</head>
<body>
  <div id="grid"></div>
  <button id="next">Next generation</button>
  <button id="run">Auto run</button>
  <script>
    let grid = document.getElementById("grid");
    const width = 30, height = 15;
    let checkBoxes = [];
    let boxVecs = [];
    
    class Vec {
      constructor(x, y, status) {
        this.x = x;
        this.y = y;
        this.status = status;
      }
    }

    for (let y = 0; y < height; y++) {
      for (let x = 0; x < width; x++) {
        let checkBox = document.createElement("input");
        checkBox.type = "checkbox";
        grid.appendChild(checkBox);
        checkBoxes.push(checkBox);
        boxVecs.push(new Vec(x, y));
      }
      grid.appendChild(document.createElement("br"));
    }
    //checkBoxes[2].removeAttribute("checked", "");
    
    function randomGrid() {
      let i = 0, result = [];
      while (i < width * height) {
        result.push(Math.random() < 0.3);
        i++;
      }
      return result;
    }

    function nextGeneration(values) {
      values.map( (value, i) => {
        checkBoxes[i].checked = value;
        boxVecs[i].status = value;
      })
    };
    
    nextGeneration(randomGrid());
    //document.querySelector("input").setAttribute("checked", "");
    //console.log(document.querySelectorAll("input")[2].checked);
    //console.log(boxVecs[449]);
    
    function boxVecsIndex(x1, y1) {
      let index;
      boxVecs.forEach( (z, i) => {
        if (z.x === x1 && z.y === y1) index = i; 
      })
      return index;
    }

    function findNeighbors(x, y, index) {
      let neighbors = 0;
      let cell = boxVecs[index];
      for (let y1 = Math.max(0, y - 1); y1 <= Math.min(height - 1, y + 1); y1++) {
        for (let x1 = Math.max(0, x - 1); x1 <= Math.min(width - 1, x + 1); x1++) {
          
          console.log("cell: " + `${cell.x}, ${cell.y}` + " , x1 y1: " + x1 + ", " + y1 + `, index ${index}`);
          let cellNeighbor = boxVecs[boxVecsIndex(x1, y1)];
          console.log("cellNeighbor: " + `${cellNeighbor.x}, ${cellNeighbor.y} cn status: ${cellNeighbor.status}, ` + ` index: ${index}`);
          console.log(`cell == cn: ${cell === cellNeighbor}`);
          if (cell === cellNeighbor) {
            console.log("x1++");
            continue;
          } else {
            if (cellNeighbor.status) {
              neighbors++;
              console.log(`neighbors: ${neighbors}`);
            }
          }
        }
      }
      //console.log(`neighbors: ${neighbors}`);
      return neighbors;
    }  
    console.log(findNeighbors(0, 0, 0));
    function lifeGrid() {
      let values = new Array(width * height);
      boxVecs.forEach( ({x, y, status}, index) => {
        let neighbors = findNeighbors(x, y, index);
        //console.log(neighbors);
        if (status) {
          if (neighbors < 2 || neighbors > 3) values[index] = !status;
          if (neighbors === 2 || neighbors === 3) values[index] = status;
        } else if (!status) {
          if (neighbors === 3) values[index] = status;
        }
      });
      //console.log(values);
      return values;
    }

    function turn() {
      nextGeneration(lifeGrid());
    }
        
    document.getElementById("next").addEventListener("click", turn);
    
    
  </script>
</body>
</html>